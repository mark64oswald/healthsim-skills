# HealthSim Workspace Comprehensive Audit

**Date:** 2026-01-05  
**Status:** IN PROGRESS

---

## Executive Summary

This audit evaluates the HealthSim Workspace for:
1. Architecture and organization consistency
2. Documentation quality and completeness
3. Terminology consistency (scenario vs cohort refactor)
4. Generative Framework integration

---

## Part 1: Terminology Analysis

### Key Distinction: "Scenario" vs "Cohort"

| Term | Definition | When to Use |
|------|------------|-------------|
| **Cohort** | A saved collection of entities (patients, members, claims) - the DATA CONTAINER | Database tables, save/load operations, MCP state tools |
| **Scenario** (clinical) | A clinical workflow pattern (diabetic journey, surgery pathway) - BUSINESS LOGIC | Clinical pathway templates in membersim/rxmembersim |
| **Journey** | Event timeline specification - similar to scenario but for the new Generative Framework | Profile/journey builders, generation templates |

### Refactoring Status

#### âœ… COMPLETE - Database Schema
- `cohorts` table
- `cohort_entities` table  
- `cohort_tags` table
- `cohort_id` columns

#### âœ… COMPLETE - Core MCP Server (healthsim_mcp.py)
- `healthsim_list_cohorts`
- `healthsim_load_cohort`
- `healthsim_save_cohort`
- `healthsim_delete_cohort`

#### âŒ NEEDS UPDATE - PatientSim MCP Server (packages/patientsim/src/patientsim/mcp/generation_server.py)
- `save_scenario` â†’ `save_cohort`
- `load_scenario` â†’ `load_cohort`
- `list_saved_scenarios` â†’ `list_cohorts`
- `delete_scenario` â†’ `delete_cohort`

#### âŒ NEEDS UPDATE - PatientSim MCP Server (packages/patientsim/src/mcp/state_server.py)
- Similar scenario â†’ cohort renames needed

#### âŒ NEEDS UPDATE - RxMemberSim MCP Server (packages/rxmembersim/src/rxmembersim/mcp/server.py)
- Similar scenario â†’ cohort renames needed

#### âš ï¸ KEEP AS-IS - Clinical Scenario Modules (LEGITIMATE)
These use "scenario" correctly as a clinical domain concept:
- `packages/membersim/src/membersim/scenarios/` - Clinical pathway templates
- `packages/rxmembersim/src/rxmembersim/scenarios/` - Rx clinical pathways
- `DIABETIC_MEMBER_SCENARIO`, `NEW_EMPLOYEE_SCENARIO`, etc.

#### âš ï¸ EVALUATE - Skill Types
- `SkillType.SCENARIO_TEMPLATE` in schema.py - May need to become `JOURNEY_TEMPLATE`

---

## Part 2: File-by-File Terminology Audit

### Python Files with "scenario" (680 total occurrences)

| File | Count | Category | Action |
|------|-------|----------|--------|
| patientsim/mcp/generation_server.py | 121 | MCP Tools | âŒ REFACTOR to cohort |
| patientsim/mcp/state_server.py | 68 | MCP Tools | âŒ REFACTOR to cohort |
| patientsim/tests/mcp/test_session.py | 65 | Tests | âŒ REFACTOR to cohort |
| core/db/migrations.py | 51 | Database | âŒ REFACTOR to cohort |
| rxmembersim/mcp/server.py | 29 | MCP Tools | âŒ REFACTOR to cohort |
| rxmembersim/scenarios/engine.py | 23 | Clinical | âœ… KEEP (clinical scenario) |
| membersim/scenarios/templates/*.py | ~40 | Clinical | âœ… KEEP (clinical scenario) |
| membersim/scenarios/definition.py | 17 | Clinical | âœ… KEEP (clinical scenario) |
| patientsim/mcp/formatters.py | 14 | MCP | âŒ REFACTOR to cohort |
| skills/schema.py | 7 | Skills | âš ï¸ EVALUATE |
| refactor_*.py | ~70 | Scripts | ğŸ—‘ï¸ DELETE after refactor |

---

## Part 3: Project Structure Audit

### Expected Consistent Structure (per product)

```
packages/{product}/
â”œâ”€â”€ README.md           âœ… Required
â”œâ”€â”€ CLAUDE.md          âœ… Required (AI guidance)
â”œâ”€â”€ pyproject.toml     âœ… Required
â”œâ”€â”€ src/
â”‚   â””â”€â”€ {product}/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ core/       # Core domain models
â”‚       â”œâ”€â”€ mcp/        # MCP server tools
â”‚       â””â”€â”€ formats/    # Export formats (FHIR, HL7, etc.)
â””â”€â”€ tests/
    â””â”€â”€ test_*.py
```

### Package Structure Status

| Package | README | CLAUDE.md | Tests | MCP | Status |
|---------|--------|-----------|-------|-----|--------|
| core | âœ… | âœ… | âœ… | N/A | Good |
| patientsim | âœ… | âœ… | âœ… | âœ… | Good |
| membersim | âœ… | âœ… | âœ… | âš ï¸ | Good |
| rxmembersim | âœ… | âœ… | âœ… | âœ… | Good |
| mcp-server | âœ… | âŒ | âœ… | âœ… | Missing CLAUDE.md |

---

## Part 4: Documentation Audit

### README Files to Verify

| Location | Exists | Quality | Links |
|----------|--------|---------|-------|
| /README.md | âœ… | TBD | TBD |
| /packages/README.md | âœ… | TBD | TBD |
| /packages/core/README.md | âœ… | TBD | TBD |
| /packages/patientsim/README.md | âœ… | TBD | TBD |
| /packages/membersim/README.md | âœ… | TBD | TBD |
| /packages/rxmembersim/README.md | âœ… | TBD | TBD |
| /packages/mcp-server/README.md | âœ… | TBD | TBD |
| /skills/README.md | TBD | TBD | TBD |
| /hello-healthsim/README.md | âœ… | TBD | TBD |
| /docs/README.md | âœ… | TBD | TBD |

### Skills Documentation

| Skill Area | README | SKILL.md | Sub-Skills |
|------------|--------|----------|------------|
| generation | âœ… | âœ… | TBD |
| patientsim | âœ… | âœ… | TBD |
| membersim | âœ… | âœ… | TBD |
| rxmembersim | âœ… | âœ… | TBD |
| populationsim | âœ… | âœ… | TBD |
| networksim | âœ… | âœ… | TBD |
| trialsim | âœ… | âœ… | TBD |

---

## Part 5: Generative Framework Integration

### New Generation Modules (packages/core/src/healthsim/generation/)

| Module | Lines | Tests | Documentation |
|--------|-------|-------|---------------|
| distributions.py | ~700 | 89 | âœ… |
| profile_schema.py | ~265 | - | âœ… |
| profile_executor.py | ~600 | 17 | âœ… |
| reference_profiles.py | ~400 | 19 | âœ… |
| journey_engine.py | ~500 | 27 | âœ… |
| triggers.py | ~350 | 13 | âœ… |
| handlers.py | ~1240 | 20 | âœ… |

### Skills for Generation (skills/generation/)

| File | Purpose | Status |
|------|---------|--------|
| SKILL.md | Main entry point | âœ… |
| builders/profile-builder.md | Profile building | âœ… |
| builders/journey-builder.md | Journey building | âœ… |
| distributions/distribution-types.md | Distribution reference | âœ… |
| templates/profiles/*.json | Profile templates | âœ… |
| templates/journeys/*.json | Journey templates | âœ… |

---

## Action Items

### Priority 1: Terminology Refactor (Est: 2-3 hours)

1. [ ] Refactor `packages/patientsim/src/patientsim/mcp/generation_server.py`
2. [ ] Refactor `packages/patientsim/src/mcp/state_server.py`
3. [ ] Refactor `packages/patientsim/src/patientsim/mcp/formatters.py`
4. [ ] Refactor `packages/rxmembersim/src/rxmembersim/mcp/server.py`
5. [ ] Update all related tests
6. [ ] Evaluate SkillType.SCENARIO_TEMPLATE rename

### Priority 2: Documentation Quality

1. [ ] Verify all README links work
2. [ ] Check hello-healthsim tutorials are current
3. [ ] Verify skills documentation accuracy

### Priority 3: Cleanup

1. [ ] Remove refactor_*.py scripts from root
2. [ ] Clean up deprecated files
3. [ ] Update CHANGELOG.md

---

## Progress Log

| Date | Action | Status |
|------|--------|--------|
| 2026-01-05 | Audit started | â³ |

